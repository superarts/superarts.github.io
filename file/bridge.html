<html>
    <body>
        <h1>WKWebView bridging test 2</h1>
        <p><input type="text" value="Test text here" id="displayText" style="width:100%"></input><br /></p>
        <input onclick="updateText('Test text from button')" type="button" value="Test update text" id="testButton"></input>
        <input onclick="requestAccessToken()" type="button" value="Request access token" id="Button1"></input>
        <input onclick="requestRefreshToken()" type="button" value="Request refresh token" id="Button2"></input>
    </body>
    <script>

function setupWKWebViewJavascriptBridge(callback) {
    if (window.WKWebViewJavascriptBridge) { return callback(WKWebViewJavascriptBridge) }
    if (window.WKWVJBCallbacks) { return window.WKWVJBCallbacks.push(callback) }
    window.WKWVJBCallbacks = [callback]
    window.webkit.messageHandlers.iOS_Native_InjectJavascript.postMessage(null)
}

function updateText(message) {
    document.getElementById("displayText").value=message
}

function requestAccessToken() {
    updateText("Access token requested...")
    setupWKWebViewJavascriptBridge(function(bridge) {
        bridge.callHandler('requestAuthToken', {'tokenType': 'accessToken'}, function(response) {
            console.log('JS got response', response)
            updateText("Access token: " + response)
        })
    })
}

function requestRefreshToken() {
    updateText("Refresh token requested...")
    setupWKWebViewJavascriptBridge(function(bridge) {
        bridge.callHandler('requestAuthToken', {'tokenType': 'refreshToken'}, function(response) {
            console.log('JS got response', response)
            updateText("Refresh token: " + response)
        })
    })
}

setupWKWebViewJavascriptBridge(function(bridge) {
	bridge.registerHandler('testJavascriptHandler', function(data, responseCallback) {
		console.log('iOS called testJavascriptHandler with', data)
		responseCallback({ 'Javascript Says':'Right back atcha!' })
	})
})

    </script>
</html>